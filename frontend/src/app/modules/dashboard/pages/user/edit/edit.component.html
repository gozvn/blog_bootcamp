<div class="modal-header">
    <h5 class="modal-title">
        Edit User
        @if (user?.email) {
        <small class="text-muted">- {{ user.email }}</small>
        }
    </h5>
    <button type="button" class="btn-close" (click)="cancel()" aria-label="Close"></button>
</div>

<div class="modal-body">


    <form [formGroup]="editForm" (ngSubmit)="onSubmit()">
        <!-- Username Field -->
        <div class="mb-3">
            <label for="username" class="form-label">
                Username
                <small class="text-muted">(optional - leave unchanged if not editing)</small>
            </label>
            <input type="text" class="form-control" id="username" formControlName="username"
                [class.is-invalid]="f['username'].invalid && f['username'].touched"
                [class.is-valid]="f['username'].valid && f['username'].touched && f['username'].value"
                placeholder="Enter new username">

            @if (f['username'].invalid && f['username'].touched) {
            <div class="invalid-feedback">
                <span>Please provide a valid username.</span>
            </div>
            }

            @if (f['username'].valid && f['username'].touched && f['username'].value) {
            <div class="valid-feedback">
                Username looks good!
            </div>
            }
        </div>

        <!-- Email Field -->
        <div class="mb-3">
            <label for="email" class="form-label">
                Email Address
                <small class="text-muted">(optional - leave unchanged if not editing)</small>
            </label>
            <input type="email" class="form-control" id="email" formControlName="email"
                [class.is-invalid]="f['email'].invalid && f['email'].touched"
                [class.is-valid]="f['email'].valid && f['email'].touched" placeholder="Enter new email address">

            @if (f['email'].invalid && f['email'].touched) {
            <div class="invalid-feedback">
                @if (f['email'].errors?.['email']) {
                <span>Please provide a valid email address.</span>
                }
            </div>
            }

            @if (f['email'].valid && f['email'].touched && f['email'].value) {
            <div class="valid-feedback">
                Email format is valid!
            </div>
            }
        </div>

        <!-- Role Field -->
        <div class="mb-3">
            <label for="role" class="form-label">
                Role
                <small class="text-muted">(optional - leave unchanged if not editing)</small>
            </label>
            <select class="form-select" id="role" formControlName="role"
                [class.is-invalid]="f['role'].invalid && f['role'].touched"
                [class.is-valid]="f['role'].valid && f['role'].touched && f['role'].value">
                <option value="">Keep current role</option>
                <option value="1">Admin</option>
                <option value="2">Moderator</option>
                <option value="3">Editor</option>
                <option value="4">User</option>
            </select>

            @if (f['role'].invalid && f['role'].touched) {
            <div class="invalid-feedback">
                Please select a valid role.
            </div>
            }

            @if (f['role'].valid && f['role'].touched && f['role'].value) {
            <div class="valid-feedback">
                Role selected!
            </div>
            }
        </div>

        <!-- Password Field -->
        <div class="mb-3">
            <label for="password" class="form-label">
                Password <small class="text-muted">(leave empty if not changing)</small>
            </label>
            <input type="password" class="form-control" id="password" formControlName="password"
                [class.is-invalid]="f['password'].invalid && f['password'].touched"
                [class.is-valid]="f['password'].valid && f['password'].touched && f['password'].value"
                placeholder="Enter new password">

            @if (f['password'].invalid && f['password'].touched) {
            <div class="invalid-feedback">
                Password must be at least 6 characters long.
            </div>
            }

            @if (f['password'].valid && f['password'].touched && f['password'].value) {
            <div class="valid-feedback">
                Password strength is good!
            </div>
            }

            <div class="form-text">
                Password should be at least 6 characters long for security.
            </div>
        </div>
    </form>
</div>

<div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="cancel()" [disabled]="isSubmitting">
        <i class="bi bi-x-circle me-1"></i>Cancel
    </button>
    <button type="button" class="btn btn-primary" (click)="onSubmit()" [disabled]="isSubmitting">
        @if (isSubmitting) {
        <span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>
        Saving...
        } @else {
        <i class="bi bi-save me-1"></i>Save Changes
        }
    </button>
</div>
<app-toast></app-toast>